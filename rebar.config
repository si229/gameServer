{erl_opts, [
    debug_info,
    nowarn_unused_function, nowarn_unused_vars,
    {parse_transform, lager_transform}
    ]}.
{deps, [
    {cowboy,{git,"https://github.com/ninenines/cowboy.git",{tag,"2.14.2"}}},
    {lager,{git,"https://github.com/erlang-lager/lager.git",{tag,"3.9.1"}}},
    {gproc,{git,"https://github.com/uwiger/gproc.git",{branch,"master"}}},
    {mn_climber,{git,"https://github.com/feng19/mn_climber.git",{tag,"0.2.1"}}},
    {gen_smtp,{git,"https://github.com/gen-smtp/gen_smtp.git",{tag,"1.3.0"}}},
    {jsx,"2.11.0"}
%%    {edown, {git, "https://github.com/esl/edown.git", {branch,"master"}}},
%%    {gen_leader, {git, "https://github.com/abecciu/gen_leader_revival.git", {branch,"master"}}}
]}.


{shell, [
    {apps, [game_server]} ,
    {config, "config/sys.config"}
]}.


{dist_node, [
    {name, 'game_server@127.0.0.1'},
    {setcookie, 'mysecretcookie'}
]}.


{relx, [
    {release, {game_server, "0.1.0"}, [
        game_server,
        sasl
    ]},
    {mode, dev},
    {sys_config, "./config/sys.config"},
    {vm_args, "./config/vm.args"}
]}.



{plugins, [
    {rebar3_gpb_rpc_plugin,{git,"https://github.com/si229/gpb_rpc_plugin.git",{branch,"main"}}}
]}.

{provider_hooks, [
    {compile, {protobuf, compile}},
    {clean, {protobuf, clean}},
%%      for gpb rpc
    {compile, {gpb_rpc, compile}},
    {clean, {gpb_rpc, clean}}
]}.


%% gpb的配置
{gpb_opts, [
    {i, "proto"},
    msg_name_to_snake_case,
    strings_as_binaries,
    include_as_lib,
%%    use_packages
%%    {nif, true},
    {verify, always},
    {o_erl, "src/proto"},
    {o_hrl, "include/"},

    {module_name_suffix, "_pb"}
]}.

%% gpb_rpc的配置
{gpb_rpc_opts, [
    msg_name_to_snake_case,
    {router, "proto/msg.proto"},
    {msg_prefix, "msg_"},
    {mod_prefix, "mod_"},
    {o_erl, "src/msg"},
    {o_hrl, "include/"},
    {erl_tpl, "templates/gpb_rpc/gpb_rpc.erl.tpl"},
    {hrl_tpl, "templates/gpb_rpc/gpb_rpc.hrl.tpl"},
    {router_erl_tpl, "templates/gpb_rpc/gpb_rpc_router.erl.tpl"},
    {router_hrl_tpl, "templates/gpb_rpc/gpb_rpc_router.hrl.tpl"}
]}.



{profiles, [
    {prod, [
        {relx, [
            {mode, prod}
        ]}
    ]}
]}.
